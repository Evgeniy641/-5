Отчет по лабораторной работе №5
LINQ-запросы
Студент: Баранов Евгений Артемьевич ИТ-7,8

Лабораторная работа №5
Задания:

1. Чтение базы данных из excel файла

2. Просмотр базы данных

3. Удаление элементов (по ключу)

4. Добавление элементов

5. Реализация 4 запросов:

1. 1 запрос с обращением к одной таблице (перечень)

2. 1 запрос с обращением к двум таблицам (значение)

3. 2 запроса с обращением к трем таблицам (перечень и значение)

6. Сохранение изменений в excel файле

Реализация
Классы данных
Класс Animal (таблица "Животные")

Свойства: Id, Species (вид), Breed (порода)

Класс Customer (таблица "Покупатели")

Свойства: Id, Name (имя), Age (возраст), Address (адрес)

Класс Sale (таблица "Продажи")

Свойства: Id, AnimalId (ID животного), CustomerId (ID покупателя), Date (дата), Price (цена)

1. Чтение из Excel файла
Метод: LoadFromExcel()

Использует библиотеку ExcelDataReader для чтения данных из файла. Ожидает три листа: "Животные", "Покупатели", "Продажи". Данные преобразуются в объекты соответствующих классов.

2. Просмотр базы данных
Метод: ViewAllData()

Выводит на консоль содержимое всех трех таблиц в форматированном виде.

3. Удаление элементов
Методы: DeleteAnimal(), DeleteCustomer(), DeleteSale()

Удаляют записи по идентификатору. При удалении животного или покупателя проверяется наличие связанных продаж.

4. Добавление элементов
Методы: AddAnimal(), AddCustomer(), AddSale()

Добавляют новые записи с проверкой уникальности ID и существования связанных записей.

5. LINQ-запросы
Запрос 1 (одна таблица, перечень)
Метод: GetSphynxCats()

Найти всех кошек породы «Сфинкс».

Тест:

ID	Вид	Порода
1	Кошка	Сфинкс
9	Кошка	Сфинкс
Результат: 2 записи

Запрос 2 (две таблицы, одно значение)
Метод: GetTotalSalesForCustomersOver30()

Подсчитать общую сумму продаж для покупателей старше 30 лет.

Тест:
Покупатели старше 30 лет: Петрова (35), Сидоров (42), Морозов (55), Лебедева (45)
Сумма продаж: 35000 + 31000 + 38000 + 52000 + 40000 + 35000 = 231000 руб.

Результат: 231000

Запрос 3 (три таблицы, перечень)
Метод: GetCatSalesWithDetails()

Получить информацию о всех продажах кошек с указанием породы и имени покупателя.

Тест:

Дата: 15.01.2023, Порода: Сфинкс, Покупатель: Петрова Анна, Цена: 35000

Дата: 25.01.2023, Порода: Британская, Покупатель: Козлова Елена, Цена: 42000

Дата: 12.02.2023, Порода: Персидская, Покупатель: Волкова Татьяна, Цена: 25000

Дата: 18.02.2023, Порода: Сфинкс, Покупатель: Морозов Дмитрий, Цена: 38000

Дата: 20.03.2023, Порода: Мейн-кун, Покупатель: Лебедева Ольга, Цена: 40000

Результат: 5 записей

Запрос 4 (три таблицы, одно значение)
Метод: GetAverageAgeOfDachshundBuyers()

Найти средний возраст покупателей, купивших собак породы «Такса».

Тест:
Покупатели такс: Иванов (25 лет), Сидоров (42 года)
Средний возраст = (25 + 42) / 2 = 33.5

Результат: 33,5

6. Сохранение изменений в Excel
Метод: SaveToExcel()

Использует библиотеку EPPlus для сохранения данных обратно в Excel-файл. При сохранении:

Данные из списков Animals, Customers, Sales записываются в соответствующие листы

Автоматически подбирается ширина колонок

Удаляются лишние строки
